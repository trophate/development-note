# 简介

KMP是一种改进字符串匹配算法。它利用匹配失败信息来减少子串与主串的匹配次数以达到快速匹配的目的。

<br/>

# 原理

KMP利用匹配失败信息来减少子串与主串的匹配次数，它部分匹配表实现。子串又称模式串。

以下图为例：

![](../img/KMP原理_1.svg) 

普通匹配是主串指针向前回溯，子串指针回到起始，然后重新匹配。现在已经有一段已匹配的串了，匹配串的后段如果与子串的前段有重叠部分，那么这段即可当成已匹配的，基于这种处理，主串指针也不用回溯。图中abc“ab”与“ab”cabn的“ab”匹配，下次匹配主串指针不动，子串从c开始。

![](../img/KMP原理_2.svg) 

<br/>

## 部分匹配表（PMT）

部分匹配表又称next数组。PMT记录了字符串以首字符开始的子串前缀集合和后缀集合交集中的最长元素长度。

### 概念

设有字符串str = abacaba。

#### 1. 前缀

以字符串首字符开始且不包含尾字符的子串。

str的前缀集合为：{a, ab, aba, abac, abaca, abacab}。

#### 2. 后缀

以字符串尾字符结尾且不包含首字符的字串。

str的后缀集合为：{a, ba, aba, caba, acaba, bacaba}。

<br/>

str前缀集合与后缀集合的交集为：{a, aba}，最长元素长度为：3。

<br>

# 执行过程

1. 设有主串aStr=ckabcabmp，子串bStr=abcabe

   ![](../img/KMP流程_1.svg) 

2. 开始匹配

   ![](../img/KMP流程_2.svg) 

3. 此时在PMT查找已匹配成功串（abcab）的值（2），将子串指针移动该值索引处，开始下一次匹配。

   ![](../img/KMP流程_3.svg) 

4. 重复以上步骤直到匹配结束。

<br>

# 构建PMT

设有字符串s，数组next，指针i（待设值位），j。初始有next[0]=0，i=0，j=1。如果有s[i]=s[j]，那么next[i]=j+1，i，j均后移；如果有s[i]!=s[j]且j>0，那么j=next[j]，直到满足第一个条件；如果有s[i]!=s[j]且j==0，那么next[i]=0，i后移，j不变。